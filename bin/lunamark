#!/usr/bin/env lua
-- lunamark program

local lunamark = require("lunamark")

local options = {
  "lunamark [options] file - convert text from markdown",
   to      = { shortform = true,
               arg = "format",
               description = "Target format"},
   from    = { shortform = true,
               arg = "format",
               description = "Source format"},
   }

local defaults = {
   to  = "html",
   from = "markdown"
 }

local args = lunamark.cmdopts.getargs(options, defaults)

local reader = lunamark.reader[args.from:lower()]
if not reader then
  lunamark.util.err("Unknown reader: " .. tostring(args.from), 3)
end

local writer = lunamark.writer[args.to:lower()]
if not writer then
  lunamark.util.err("Unknown writer: " .. tostring(args.to), 5)
end

writer.options.minimize = false
writer.options.blanklines = false

local convert = markdown(writer,{})

io.write(convert(util.get_input(args,4)))
